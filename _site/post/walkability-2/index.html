<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2020-11-29">
<meta name="description" content="Part 2: Calculating elevation-sensitve walkability.">

<title>Shrividya Ravi - Walking in Wellington - walkability metrics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Shrividya Ravi</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../projects.html"> 
<span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../articles.html"> 
<span class="menu-text">Articles</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">Technical blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../talks.html"> 
<span class="menu-text">Presentations</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/shriv"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/ShrividyaRavi"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#technical-overview" id="toc-technical-overview" class="nav-link" data-scroll-target="#technical-overview">Technical overview</a></li>
  <li><a href="#data-munging" id="toc-data-munging" class="nav-link" data-scroll-target="#data-munging">Data munging</a>
  <ul class="collapse">
  <li><a href="#wcc-playgrounds" id="toc-wcc-playgrounds" class="nav-link" data-scroll-target="#wcc-playgrounds">WCC Playgrounds</a></li>
  <li><a href="#wellington-street-network-without-elevation" id="toc-wellington-street-network-without-elevation" class="nav-link" data-scroll-target="#wellington-street-network-without-elevation">Wellington street network: without elevation</a></li>
  <li><a href="#wellington-street-network-with-elevation" id="toc-wellington-street-network-with-elevation" class="nav-link" data-scroll-target="#wellington-street-network-with-elevation">Wellington street network: with elevation</a></li>
  </ul></li>
  <li><a href="#accessibility-analysis-for-hilly-wellington" id="toc-accessibility-analysis-for-hilly-wellington" class="nav-link" data-scroll-target="#accessibility-analysis-for-hilly-wellington">Accessibility analysis for hilly Wellington</a>
  <ul class="collapse">
  <li><a href="#hills-vs.-flat" id="toc-hills-vs.-flat" class="nav-link" data-scroll-target="#hills-vs.-flat">Hills vs.&nbsp;Flat</a></li>
  <li><a href="#impact-of-hills-on-travel-time" id="toc-impact-of-hills-on-travel-time" class="nav-link" data-scroll-target="#impact-of-hills-on-travel-time">Impact of hills on travel time</a></li>
  <li><a href="#nearby-options" id="toc-nearby-options" class="nav-link" data-scroll-target="#nearby-options">Nearby options?</a></li>
  </ul></li>
  <li><a href="#conclusions" id="toc-conclusions" class="nav-link" data-scroll-target="#conclusions">Conclusions</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Walking in Wellington - walkability metrics</h1>
  <div class="quarto-categories">
    <div class="quarto-category">data science</div>
    <div class="quarto-category">walkability</div>
    <div class="quarto-category">transport</div>
    <div class="quarto-category">new zealand</div>
    <div class="quarto-category">network analysis</div>
  </div>
  </div>

<div>
  <div class="description">
    Part 2: Calculating elevation-sensitve walkability.
  </div>
</div>


<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 29, 2020</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Playgrounds are important local amenities that are designed with pedestrian access in mind. Hence, accessibility to playgrounds can act as a proxy for measuring <em>walkability</em> of a city. Good design of local amenities should manage the various factors that might prohibit walking. For example, difficult terrain, population density induced crowding etc. In this post, we’ll be examining the following question in detail.</p>
<blockquote class="blockquote">
<p><em>How prohibitive is Wellington’s topography on pedestrian accessibility to playgrounds?</em></p>
</blockquote>
<p>In a <a href="https://shriv.github.io/Playgrounds-vs-pubs/">previous post</a>, accessibility was calculated in units of distance. Distance is an excellent metric for driving or walking on flat land. For short travels by car or walking on flat land, distance can be directly converted to travel time - since most people have an intuitive understanding of their average driving speeds (50 km/h for residential roads in New Zealand), or their approximate walking speed on flat land (usually around 5 km / h for a fit adult as given in <a href="https://www.nzta.govt.nz/assets/resources/pedestrian-planning-guide/docs/pedestrian-planning-guide.pdf">Section 3.4 in NZTA pedestrian planning and design guide</a>). Hills are not an issue for drivers provided road quality and safety are no different to flat land. But hills do impact travel time for pedestrians; which in turn impacts accessibility.</p>
</section>
<section id="technical-overview" class="level2">
<h2 class="anchored" data-anchor-id="technical-overview">Technical overview</h2>
<p>This post is quite heavy on technical detail - accessibility analysis that includes the impact of street gradients on travel speed isn’t an <em>out of the box</em> analysis. So, this post is much more of a <em>methodology</em> post with some (hopefully, interesting and useful) insights along the way.</p>
<p>Key technical challenges that needed to be overcome are listed and referenced below. Some are covered in this post, others are only available in the companion <a href="https://github.com/shriv/accessibility-series/blob/master/Accounting%20for%20hills%20in%20accessibility%20analyses.ipynb">Jupyter Notebook</a></p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">Issue</th>
<th style="text-align: left;">Covered in</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><a href="#wellington-street-network-without-elevation">Converting accessibility metric from distance to travel time</a></td>
<td style="text-align: left;">Blog Post</td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#wellington-street-network-with-elevation">Getting street gradients from elevation data</a></td>
<td style="text-align: left;">Blog Post</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#converting-incline-distance-to-travel-time">Adjusting travel time according to street gradients</a></td>
<td style="text-align: left;">Blog Post</td>
</tr>
<tr class="even">
<td style="text-align: center;">Filtering street gradient networks</td>
<td style="text-align: left;"><a href="https://github.com/shriv/accessibility-series/blob/master/Accounting%20for%20hills%20in%20accessibility%20analyses.ipynb">Jupyter Notebook</a></td>
</tr>
<tr class="odd">
<td style="text-align: center;">Creating <em>pandana</em> network from <em>osmnx</em> graph with street gradients</td>
<td style="text-align: left;"><a href="https://github.com/shriv/accessibility-series/blob/master/Accounting%20for%20hills%20in%20accessibility%20analyses.ipynb">Jupyter Notebook</a></td>
</tr>
<tr class="even">
<td style="text-align: center;">Adding colourbars to <em>osmnx</em> isochrone plots</td>
<td style="text-align: left;"><a href="https://github.com/shriv/accessibility-series/blob/master/Accounting%20for%20hills%20in%20accessibility%20analyses.ipynb">Jupyter Notebook</a></td>
</tr>
<tr class="odd">
<td style="text-align: center;">Calculating route statistics with <em>osmnx</em> and <em>pandana</em></td>
<td style="text-align: left;"><a href="https://github.com/shriv/accessibility-series/blob/master/Accounting%20for%20hills%20in%20accessibility%20analyses.ipynb">Jupyter Notebook</a></td>
</tr>
</tbody>
</table>
</section>
<section id="data-munging" class="level2">
<h2 class="anchored" data-anchor-id="data-munging">Data munging</h2>
<p>All the technical challenges identified above involve data munging. The relief is that we’ll only be working with two datasets, and most of the munging is done with the street network.</p>
<ul>
<li><a href="https://data-wcc.opendata.arcgis.com/datasets/c3b0ae6ee9d44a7786b0990e6ea39e5d_0?geometry=174.749%2C-41.324%2C174.881%2C-41.302&amp;page=2"><em>WCC playground locations</em></a>: downloaded as a zip file</li>
<li><em>Wellington street network</em>
<ul>
<li>without elevation: using OpenStreetMap via <em>pandana</em></li>
<li>with elevation: using OpenStreetMap and Google Elevation API via <em>osmnx</em></li>
</ul></li>
</ul>
<section id="wcc-playgrounds" class="level3">
<h3 class="anchored" data-anchor-id="wcc-playgrounds">WCC Playgrounds</h3>
<p>The WCC playground data is easy to consume as it’s just a set of geolocations. The form is appropriate for accessibility analysis too since <em>Points of Interest</em> (POIs) are always single, representative coordinates (rather than polygons).</p>
<div class="iframe_container">
<iframe src="map_playgrounds.html" style="width: 100%; height: 450px;">
</iframe>
</div>
</section>
<section id="wellington-street-network-without-elevation" class="level3">
<h3 class="anchored" data-anchor-id="wellington-street-network-without-elevation">Wellington street network: without elevation</h3>
<p>Getting the Wellington street network in a form suitable for accessibility analysis is trivial. The previous posts <a href="https://shriv.github.io/Fuel-Stations-Analysis-Part-3/">on fuel station</a> and <a href="https://shriv.github.io/Playgrounds-vs-pubs/">playground</a> accessibility cover the process in detail. Without delving into the specifics, the process simply calls <em>pandana’s</em> OpenStreetMap loader.</p>
<section id="changing-accessibility-units" class="level4">
<h4 class="anchored" data-anchor-id="changing-accessibility-units">Changing accessibility units</h4>
<p>The default <em>pandana</em> network has edge weights in metres, which means that the accessibility analyses will also be in metres. We can post-hoc convert distance to travel time with an average walking speed of 5 km/h or, 83 m/minute if we want travel time in minutes.</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">Accessibility as distance</th>
<th style="text-align: center;">Accessibility as travel time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><img src="output_48_0.png" class="img-fluid" alt="png"></td>
<td style="text-align: center;"><img src="output_34_0.png" class="img-fluid" alt="png"></td>
</tr>
</tbody>
</table>
<p>The accessibility data can be extracted and plotted as a histogram. Here, we see that the average distance to a playground is 700 m, or an 8 minute walk.</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">Distance distribution</th>
<th style="text-align: center;">Time distribution</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><img src="output_20_0.png" class="img-fluid" alt="png"></td>
<td style="text-align: center;"><img src="output_49_0.png" class="img-fluid" alt="png"></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="wellington-street-network-with-elevation" class="level3">
<h3 class="anchored" data-anchor-id="wellington-street-network-with-elevation">Wellington street network: with elevation</h3>
<p>Both the nodes and edges of the street network can be enriched with elevation data retrieved from Google Elevation API. Nodes have a single value for elevation. Elevation at the connecting nodes of an edge can be used to derive the <em>inclination</em> / <em>gradient</em>.</p>
<p>The above steps have been simplified to terse one-liners by the excellent Python package, <em>osmnx</em>, as shown in the code block below. They require <a href="https://developers.google.com/maps/documentation/elevation/start">signing up to the Google Elevation API</a> and getting an API key.</p>
<p>Most of the code is copied from <a href="https://geoffboeing.com/2017/05/osmnx-street-network-elevation/">Geoff Boeing’s tutorial</a>. The key difference is that I’ve stored the API key in a YAML file. By the end of the code block, we have an <em>osmnx</em> graph with street gradients for every edge in the network.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Open the API keys stored in a YAML file</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"utils/api_keys.yaml"</span>, <span class="st">'r'</span>) <span class="im">as</span> stream:</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    data_loaded <span class="op">=</span> yaml.load(stream)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get Google Elevation API key</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>google_elevation_api_key <span class="op">=</span> data_loaded[<span class="st">'google_elevation_api_key'</span>][<span class="dv">0</span>]</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an OSMNX walking street network for the Wellington bounding box</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>G <span class="op">=</span> ox.graph_from_bbox(north, south, east, west, network_type<span class="op">=</span><span class="st">'walk'</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Add elevation values for the nodes in the OSMNX graph</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>G <span class="op">=</span> ox.add_node_elevations(G, api_key<span class="op">=</span>google_elevation_api_key)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate an edge grade (inclination) with the elevations at the nodes</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>G <span class="op">=</span> ox.add_edge_grades(G)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="wellington-street-elevation-profile" class="level4">
<h4 class="anchored" data-anchor-id="wellington-street-elevation-profile">Wellington street elevation profile</h4>
<p><em>osmnx</em> generates an edge weight based on connecting node elevation values. We can extract and plot the edge gradients without and with a filter on values.</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">All street gradients</th>
<th style="text-align: center;">“Flat” regions (within 5% gradient)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><img src="output_14_0.png" class="img-fluid" alt="png"></td>
<td style="text-align: center;"><img src="output_15_0.png" class="img-fluid" alt="png"></td>
</tr>
</tbody>
</table>
<p>The graphs show that Wellington is largely flat around the coastline but is surrounded by hills. Larger suburbs like Karori and Johnsonville have been built on elevated plateaus.</p>
</section>
<section id="dealing-with-multidigraph" class="level4">
<h4 class="anchored" data-anchor-id="dealing-with-multidigraph">Dealing with MultiDiGraph</h4>
<p><em>Osmnx</em> enriches the street network with elevation and gradients using Networkx’s <em>Multidigraph</em> structure. In this structure, the edge <em>(u,v)</em> is also present as <em>(v,u)</em> with the <em>opposite</em> gradient. The duplication is why the average elevation profile is 0 and symmetric!</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="output_27_0.png" class="img-fluid figure-img"></p>
<figcaption>png</figcaption>
</figure>
</div>
<p>Since accessibility analysis doesn’t prescribe a starting point, we have to take both <em>to</em> and <em>from</em> journeys to fully quantify the impact of hills on travel time. To do this, we need to (1) split the components of the graph, (2) calculate accessibility for each component and, (3) sum the components as <em>total travel time</em>.</p>
<p>The street network can be easily split to only give unique <em>(u,v)</em> in one graph and the inverse, <em>(v,u)</em>, in another. Accessibility analysis is performed for <em>each</em> network and the values summed together to give the <em>total accessibility</em>.</p>
<table class="table">
<colgroup>
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">graph</th>
<th style="text-align: center;">geometry</th>
<th style="text-align: center;">grade</th>
<th style="text-align: center;">length</th>
<th style="text-align: center;">name</th>
<th style="text-align: center;">u</th>
<th style="text-align: center;">v</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Undirected (u,v)</td>
<td style="text-align: center;">LINESTRING (174.7934694 -41.2275193, 174.79300…</td>
<td style="text-align: center;">0.1319</td>
<td style="text-align: center;">66.800</td>
<td style="text-align: center;">Truscott Avenue</td>
<td style="text-align: center;">1259077823</td>
<td style="text-align: center;">1259072929</td>
</tr>
<tr class="even">
<td style="text-align: center;">Undirected (u,v)</td>
<td style="text-align: center;">LINESTRING (174.7921165 -41.2280406, 174.79263…</td>
<td style="text-align: center;">-0.0475</td>
<td style="text-align: center;">65.443</td>
<td style="text-align: center;">Truscott Avenue</td>
<td style="text-align: center;">1259077823</td>
<td style="text-align: center;">1259072943</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Undirected inverse (v,u)</td>
<td style="text-align: center;">LINESTRING (174.7934694 -41.2275193, 174.79300…</td>
<td style="text-align: center;">-0.1319</td>
<td style="text-align: center;">66.800</td>
<td style="text-align: center;">Truscott Avenue</td>
<td style="text-align: center;">1259072929</td>
<td style="text-align: center;">1259077823</td>
</tr>
<tr class="even">
<td style="text-align: center;">Undirected inverse (v,u)</td>
<td style="text-align: center;">LINESTRING (174.7921165 -41.2280406, 174.79263…</td>
<td style="text-align: center;">0.0475</td>
<td style="text-align: center;">65.443</td>
<td style="text-align: center;">Truscott Avenue</td>
<td style="text-align: center;">1259072943</td>
<td style="text-align: center;">1259077823</td>
</tr>
</tbody>
</table>
</section>
<section id="converting-incline-distance-to-travel-time" class="level4">
<h4 class="anchored" data-anchor-id="converting-incline-distance-to-travel-time">Converting incline distance to travel time</h4>
<p>A <a href="https://books.google.co.nz/books?id=SyulBQAAQBAJ&amp;pg=PA160&amp;lpg=PA160&amp;dq=walking+speed+gradient+accessibility&amp;source=bl&amp;ots=iKmtg73TIV&amp;sig=ACfU3U3N5CAAtqoA0QzfSpJubylfjneWtA&amp;hl=en&amp;sa=X&amp;ved=2ahUKEwiqqeKj3YTgAhVQXn0KHdSFDWsQ6AEwAHoECAkQAQ#v=onepage&amp;q=walking%20speed%20gradient%20accessibility&amp;f=false">simple search</a> led me to <a href="https://en.wikipedia.org/wiki/Naismith%27s_rule">Naismith’s Rule</a> and then to <a href="https://en.wikipedia.org/wiki/Tobler%27s_hiking_function">Tobler’s Hiking Function</a> to calculate travel time as a function of distance and gradient.</p>
<p>I’ve chosen to go with Tobler’s without much rationale other than its simple form. Tobler’s hiking function for speed, <span class="math inline">\(\nu\)</span>, is a shifted exponential with three parameters: <span class="math inline">\(a\)</span>, <span class="math inline">\(b\)</span> and <span class="math inline">\(c\)</span> which give the fastest speed, speed retardation due to gradient and shift from zero respectively.</p>
<p><span class="math display">\[
\nu = a\exp^{\left(-b.|slope~+~c|\right)}
\]</span></p>
<p>Note that <span class="math inline">\(slope\)</span> in the equation is a dimensionless quantity: <span class="math inline">\(\frac{dh}{dx}\)</span> (or, rise / run). Terminology-wise, <span class="math inline">\(slope\)</span>, is equivalent to <em>gradient</em> and <em>inclination</em>. Tobler’s function can also be written with slope in <em>degrees</em> (<span class="math inline">\(^{\circ}\)</span>). Similarly, speed is given in in <em>km/h</em> and can be converted to a travel time in minutes with a multiplicative factor, (60/1000). Both time and speed versions of Tobler’s function are shown in the graph below.</p>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;">a</th>
<th style="text-align: center;">b</th>
<th style="text-align: center;">c</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><em>Physical meaning</em></td>
<td style="text-align: center;">Fastest speed</td>
<td style="text-align: center;">Speed change due to gradient</td>
<td style="text-align: center;">Gradient of fastest speed</td>
</tr>
<tr class="even">
<td style="text-align: center;"><em>Mathematical representation</em></td>
<td style="text-align: center;"><span class="math inline">\(\nu_{max}\)</span></td>
<td style="text-align: center;">(<span class="math inline">\(\frac{\Delta\nu}{\Delta ~gradient}\)</span>)</td>
<td style="text-align: center;"><span class="math inline">\(gradient\|\nu_{max}\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;">Tobler</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">3.5</td>
<td style="text-align: center;">0.05</td>
</tr>
<tr class="even">
<td style="text-align: center;">Brunsdon</td>
<td style="text-align: center;">3.557</td>
<td style="text-align: center;">2.03</td>
<td style="text-align: center;">0.133</td>
</tr>
</tbody>
</table>
<p>While I haven’t read Tobler’s original paper, a <a href="https://rpubs.com/chrisbrunsdon/hiking">brief exposition of other equivalent functional forms to Tobler’s</a> has been written up by Chris Brunsdon. Brunsdon’s analysis shows a different relationship to Tobler’s - likely because the underlying data is different.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="output_24_0.png" class="img-fluid figure-img"></p>
<figcaption>png</figcaption>
</figure>
</div>
<p>For a more rigorous analysis of pedestrian accessibility, we’d refit the functional form above (or similar) as Brunsdon does for different types of pedestrians. According to NZTA and various other studies, there is significant heterogeneity in walking speed; both from the route (terrain, incline etc) and also the characteristics of the walker e.g.&nbsp;carrying things, footwear, and demographics. Anecdotally, we know that a commuter will walk at a very different speed to a father taking his children to the playground during the daytime.</p>
</section>
</section>
</section>
<section id="accessibility-analysis-for-hilly-wellington" class="level2">
<h2 class="anchored" data-anchor-id="accessibility-analysis-for-hilly-wellington">Accessibility analysis for hilly Wellington</h2>
<p>With a network of street gradients converted to travel time, we can now compare the impact of hills on accessibility. In the <a href="https://github.com/shriv/accessibility-series/blob/master/Accounting%20for%20hills%20in%20accessibility%20analyses.ipynb">companion Jupyter notebook</a>, there are a couple of additional, technical steps: - Creating a <em>pandana</em> network from an <em>osmnx</em> graph with travel time calculated according to the street gradient. - Calculating overall accessibility as <em>total</em> travel time. In the notebook this is done by calculating accessibility separately for <em>(u,v)</em> and <em>(v,u)</em> networks and summing the values.</p>
<section id="hills-vs.-flat" class="level3">
<h3 class="anchored" data-anchor-id="hills-vs.-flat">Hills vs.&nbsp;Flat</h3>
<p>The main accessibility heatmap for hilly Wellington, seen below, doesn’t look too different to the flat land assumption.</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">Flat land assumption</th>
<th style="text-align: center;">Accounting for Hills</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><img src="output_34_0.png" class="img-fluid" alt="png"></td>
<td style="text-align: center;"><img src="output_35_0.png" class="img-fluid" alt="png"></td>
</tr>
</tbody>
</table>
<p>We only see the impact of the hills when we consider a differential heatmap. Anyone familiar with the topography of Wellington will immediately note that areas around the slopes of the Town Belt and the Western Hills are affected.</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">Difference</th>
<th style="text-align: center;">Difference &gt; 2 minutes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><img src="output_37_0.png" class="img-fluid" alt="png"></td>
<td style="text-align: center;"><img src="output_38_0.png" class="img-fluid" alt="png"></td>
</tr>
</tbody>
</table>
</section>
<section id="impact-of-hills-on-travel-time" class="level3">
<h3 class="anchored" data-anchor-id="impact-of-hills-on-travel-time">Impact of hills on travel time</h3>
<p>It’s worth noting that while accessibility to playgrounds is worse due to hills, the total travel time in hilly areas only increases by 9% on average. Hilly nodes have an absolute average nearby gradient of more 5%. Sample code to calculate the average street gradient of a node is given below.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract an undirected graph from an elevation MultiDiGraph</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>G_undir <span class="op">=</span> G.to_undirected()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>nodes_gdfs, edges_gdfs <span class="op">=</span> ox.graph_to_gdfs(G_undir)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get local average gradient by node  </span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>u_grades <span class="op">=</span> (edges_gdfs</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>           .groupby(<span class="st">'u'</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>           .agg({<span class="st">'abs_grade'</span>: <span class="st">'mean'</span>})</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>           .reset_index()</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>           .rename({<span class="st">'u'</span>: <span class="st">'id'</span>}, axis<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Repeat for v</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Join u_grades and v_grades and drop duplicates</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">Hilly Nodes</th>
<th style="text-align: center;">Flat Nodes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><img src="output_50_0.png" class="img-fluid" alt="png"></td>
<td style="text-align: center;"><img src="output_55_0.png" class="img-fluid" alt="png"></td>
</tr>
</tbody>
</table>
</section>
<section id="nearby-options" class="level3">
<h3 class="anchored" data-anchor-id="nearby-options">Nearby options?</h3>
<p>The impact of Wellington’s topography is also seen in the availability of council playground options. In a future post, it would be interesting to see the choices available per capita - since flatter suburbs are also more likely to have higher population density.</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">Nearest playground</th>
<th style="text-align: center;">Second nearest playground</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><img src="output_35_0.png" class="img-fluid" alt="png"></td>
<td style="text-align: center;"><img src="output_36_0.png" class="img-fluid" alt="png"></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="conclusions" class="level2">
<h2 class="anchored" data-anchor-id="conclusions">Conclusions</h2>
<p>The average impact of hilly terrain on playground accessibility seems to be low - only a 9% increase in total travel time. However, the average is a poor representation since the distribution of travel time is highly skewed. Even under the <em>flat land</em> assumption, total travel times can be higher than 40 minutes.</p>
<p>In the following post, we will compare accessibility across different residential regions of Wellington, with the aim of identifying areas with poor access.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>